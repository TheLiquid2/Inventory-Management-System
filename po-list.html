<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Purchase Orders • IMS</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body onload="initPOList()">
  <header class="topbar">
    <nav>
      <a href="dashboard.html">Dashboard</a>
      <a href="products.html">Products</a>
      <a href="vendors.html">Vendors</a>
      <a href="settings.html">Settings</a>
      <a href="po-list.html" >Product Orders</a>
      <a href="about.html">Help</a>
    </nav>
    <button class="btn btn-sm" onclick="logout()">Logout</button>
  </header>

  <main class="container">
    <section class="card">
      <h1 class="mt-0">Purchase Orders</h1>
      <div class="row mt-12">
        <a  href="po-create.html">+ New PO</a>
        <button onclick="seedAndReloadPOs()">Seed Demo POs</button>
      </div>
    </section>

    <section class="card mt-12">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>PO #</th>
              <th>Vendor</th>
              <th>Date</th>
              <th>Status</th>
              <th>Total</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="poBody"></tbody>
        </table>
      </div>
      <p id="poEmpty" class="hint" style="display:none;"></p>
    </section>

   
  </main>

  <script src="auth.js"></script>
  <script src="storage.js"></script>
  <script src="utils.js"></script>
  <script>
    function initPOList() {
      requireAuth();
      renderPOs();
    }
    function seedAndReloadPOs() {
      seedDemoPOs();
      renderPOs();
    }
    function renderPOs() {
      const body = document.getElementById('poBody');
      const empty = document.getElementById('poEmpty');
      const rows = getPOs().sort((a,b) => b.id - a.id);
      if (!rows.length) {
        empty.textContent = 'No purchase orders yet. Create the first one.';
        empty.style.display = 'block';
        body.innerHTML = '';
        return;
      }
      empty.style.display = 'none';
      body.innerHTML = rows.map(po => `
        <tr>
          <td>${po.id}</td>
          <td>${escapeHtml(po.vendorName || '—')}</td>
          <td>${formatDate(po.date)}</td>
          <td>${escapeHtml(po.status)}</td>
          <td>${formatCurrency(po.total)}</td>
          <td>
            <a class="btn btn-ghost btn-sm" href="po-view.html?id=${po.id}">View</a>
            <button class="btn btn-ghost btn-sm" onclick="deletePOConfirm(${po.id})">Delete</button>
          </td>
        </tr>
      `).join('');
    }
    function deletePOConfirm(id) {
      if (!confirm('Delete this PO? This will remove all its lines.')) return;
      deletePO(id);
      renderPOs();
    }
    function formatDate(iso) {
      if (!iso) return '—';
      try { return new Date(iso).toLocaleDateString(); } catch { return '—'; }
    }
    function escapeHtml(s) {
      return String(s ?? '')
        .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;').replace(/'/g,'&#39;');
    }
  </script>
</body>
</html>